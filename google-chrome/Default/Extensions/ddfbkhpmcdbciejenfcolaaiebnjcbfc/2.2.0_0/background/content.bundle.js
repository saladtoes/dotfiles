(()=>{function e(e){try{let t=e+" {display: none !important;}",n=document.createElement("style");if(n.type="text/css",n.styleSheet)n.styleSheet.cssText=t;else{let e=document.createTextNode(t);n.appendChild(e)}let o=document.getElementsByTagName("head");if(o.length>0)o[0].appendChild(n);else{console.warn('document error: missing the "head" element');let e=document.createElement("head");e.appendChild(n);let t=document.getElementsByTagName("html");if(t.length<=0)return void console.error('document error: missing the "html" element');t[0].appendChild(e)}console.log("Succeeded in removing the selector "+e)}catch(t){console.warn("Failed to remove the selector "+e+". Reason:\n"+t.toString())}}function t(e,t){try{for(var n=document.querySelectorAll(e),o=0;o<n.length;++o)n[o].innerText=t;console.log("Succeeded in replacing "+o+" doms to "+t+" with the selector "+e)}catch(t){console.warn("Failed to remove the selector "+e+". Reason:\n"+t.toString())}}const n=new class{constructor(){this.currentUrl=window.location.href,this.overrideResponseMessageId=null,chrome.runtime.onMessage.addListener(((e,t,n)=>{"safeguardCheckSite"===e.message&&(console.log("safeguardCheckSite"),"interactive"===document.readyState||"complete"===document.readyState?(this.overrideResponseMessageId="delegatedBlockSite",this.init()):document.addEventListener("DOMContentLoaded",(()=>{this.overrideResponseMessageId="delegatedBlockSite",this.init()}),{once:!0}))}))}triggerBlock(){console.log("Adult content detected");const e=this.overrideResponseMessageId||"blockSite";chrome.extension.sendMessage({message:e,url:this.currentUrl,reason:"porn"},(function(e){"redirect"===e.message&&(window.location.href=e.redirectUrl)})),this.overrideResponseMessageId=null}checkTitle(){let e=document.title,t=new RegExp("porn","i");e.length>0&&t.test(e)&&this.triggerBlock()}checkRequest(){console.log("Checking site now that its loaded."),chrome.extension.sendMessage({message:"checkRequest",url:this.currentUrl},(function(n){if("redirect"===n.message)window.location.href=n.redirectUrl;else if("content_mod"===n.message)for(var o in n.content_mod)try{var s=n.content_mod[o];switch(console.log("Take the action: "+JSON.stringify(s)),s.action){case"remove":e(s.target);break;case"replace":t(s.target,s.value);break;default:console.warn("Unknown action "+s.action)}}catch(e){console.error("Failed to take actions on content_mode",e)}}))}checkContent(){let e="//body[";e+="contains(., 'age-restricted')",e+=" or ",e+="contains(., 'Warning: This Site Contains Sexually Explicit Content')",e+=" or ",e+="contains(., ' contains adult material')",e+=" or ",e+="contains(., 'website contains adult material')",e+=" or ",e+="contains(., 'ADULTS ONLY DISCLAIMER')",e+=" or ",e+="contains(., 'Warning: You must be 18 years or older')",e+=" or ",e+="contains(., 'adult-only')",e+=" or ",e+="contains(., 'porn')",e+=" or ",e+="contains(., 'fuck')",e+="]";let t=document.evaluate("//body[contains(., 'age-restricted') or contains(., 'Warning: This Site Contains Sexually Explicit Content') or contains(., ' contains adult material') or contains(., 'website contains adult material') or contains(., 'ADULTS ONLY DISCLAIMER') or contains(., 'Warning: You must be 18 years or older') or contains(., 'adult-only') or contains(., 'porn') or contains(., 'fuck')]",document,null,XPathResult.ANY_TYPE,null).iterateNext();if(t){let e=t.textContent;e&&(e=e.toLowerCase(),-1===e.indexOf("porn")&&-1===e.indexOf("sex")&&-1===e.indexOf("adult")||this.triggerBlock())}}init(){console.log("Checking page..."),this.checkTitle(),this.checkContent()}};n.checkRequest(),document.addEventListener("DOMContentLoaded",(function(){n.init()}),!0)})();